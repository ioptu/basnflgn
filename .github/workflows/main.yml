name: baslgn 

on:
  schedule:
    # 1. å¯¹åº”åŒ—äº¬æ—¶é—´ 03:56 - 07:56 (UTC 19:56 - 23:56)
    - cron: '56 19-23 * * *'
    # 2. å¯¹åº”åŒ—äº¬æ—¶é—´ 08:56 - 21:56 (UTC 00:56 - 13:56)
    - cron: '56 0-13 * * *'
  workflow_dispatch:

jobs:
  run_bas_startup:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read
    timeout-minutes: 15
    
    strategy:
      fail-fast: false 
      matrix:
        account: [
          { name: "Account_1", url_secret: "BAS_URL_1", user_secret: "BAS_USERNAME_1", pass_secret: "BAS_PASSWORD_1" },
          { name: "Account_2", url_secret: "BAS_URL_2", user_secret: "BAS_USERNAME_2", pass_secret: "BAS_PASSWORD_2" }
        ]

    name: Run for ${{ matrix.account.name }}
    env:
      PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: true
      PUPPETEER_EXECUTABLE_PATH: /usr/bin/google-chrome

    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç  
        uses: actions/checkout@v5

      - name: ğŸ› ï¸ è®¾ç½® Node.js ç¯å¢ƒ 
        uses: actions/setup-node@v6
        with:
          node-version: '24' 

      - name: âš™ï¸ å®‰è£… Puppeteer ä¾èµ–
        run: npm install

      - name: ğŸ’» è¿è¡Œ BAS å¯åŠ¨è„šæœ¬ 
        run: node ka.js
        env:
          BAS_URL: ${{ secrets[matrix.account.url_secret] }}
          BAS_USERNAME: ${{ secrets[matrix.account.user_secret] }}
          BAS_PASSWORD: ${{ secrets[matrix.account.pass_secret] }}

      #- name: ğŸ“¤ ä¸Šä¼ æˆªå›¾ä½œä¸º Artifacts
        #if: always() 
        #uses: actions/upload-artifact@v4
        #with:
          #name: bas-status-screenshot-${{ matrix.account.name }}
          #path: status_screenshot/latest_bas_status.png
          #retention-days: 7         

      - name: Delete old workflow runs
        # ä»…ç”±ç¬¬ä¸€ä¸ª Jobæ‰§è¡Œï¼Œé˜²æ­¢å¹¶å‘å†²çª
        if: always() && strategy.job-index == 0
        uses: MajorScruffy/delete-old-workflow-runs@v0.3.0
        env:
          GITHUB_TOKEN: ${{ github.token }}
        with:
          repository: ${{ github.repository }}
          older-than-seconds: 25200  

  keepalive-workflow:
    name: Keepalive Workflow
    if: always()
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - uses: liskin/gh-workflow-keepalive@v1
